# `codegen.bzl` Documentation

<!-- TODO(jonathan): make this template better. -->

## Overview

A fork of codegen.bzl.

This is phoney-baloney documentation for testing the bzldoc flow.

Here is *some* _markdown_ embedded in a docstring.

Usage:

```
load("//tools/bzldoc/testdata:codegen.bzl", <rule names...>)
```

Source code:
https://github.com/enfabrica/internal/tools/bzldoc/testdata/codegen.bzl

## Rules

### `codegen` Rule

Runs codegen to combine templates and data files to an artifact.

TODO(jonathan): generalize this to generate multiple artifacts.

<table><thead><tr>
<th> Attribute </th><th> Type </th><th> Description </th>
</tr></thead><tbody>
<tr><td>

data

</td><td>

[label_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label_list)

</td><td>

An ordered list of data files to load.

</td></tr>
<tr><td>

outs

</td><td>

[output_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#output_list)

</td><td>

Artifacts to generate.

</td></tr>
<tr><td>

srcs

</td><td>

[label_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label_list)

</td><td>

A list of jinja2 template files to import.

</td></tr>
<tr><td>

schema

</td><td>

[label](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label)

</td><td>

A jsonschema file to check the imported data against.

</td></tr>
<tr><td>

overrides

</td><td>

[string_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#string_list)

</td><td>

A pair of key=value pairs to override context data.

</td></tr>
<tr><td>

template_name

</td><td>

[string](https://docs.bazel.build/versions/main/skylark/lib/attr.html#string)

</td><td>

The specific jinja2 template to render (optional).

</td></tr>
<tr><td>

multigen_mode

</td><td>

[bool](https://docs.bazel.build/versions/main/skylark/lib/attr.html#bool)

</td><td>

Enable multigen mode.

</td></tr>
<tr><td>

codegen_tool

</td><td>

[label](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label)

</td><td>

The path to the codegen tool itself.

</td></tr>
</tbody></table>

### `elab` Rule

Runs elab to elaborate data files.

<table><thead><tr>
<th> Attribute </th><th> Type </th><th> Description </th>
</tr></thead><tbody>
<tr><td>

data

</td><td>

[label_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label_list)

</td><td>

A list of data files to load.

</td></tr>
<tr><td>

deps

</td><td>

[label_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label_list)

</td><td>

A list of codegen_design target dependencies.

</td></tr>
<tr><td>

data_deps

</td><td>

[label_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label_list)

</td><td>

A list of data files dependencies to load.

</td></tr>
<tr><td>

out

</td><td>

[output](https://docs.bazel.build/versions/main/skylark/lib/attr.html#output)

</td><td>

The single artifact file to generate.

</td></tr>
<tr><td>

overrides

</td><td>

[string_list](https://docs.bazel.build/versions/main/skylark/lib/attr.html#string_list)

</td><td>

A pair of key=value pairs to override context data.

</td></tr>
<tr><td>

elab_tool

</td><td>

[label](https://docs.bazel.build/versions/main/skylark/lib/attr.html#label)

</td><td>

The path to the elab tool itself.

</td></tr>
</tbody></table>

## Macros

### `codegen_design` Macro

Usage: `codegen_design(name, config, deps)`

Generates all supported code from a design specification.

The provided data file must follow the "design" schema for specifying design
elements.

The following rules are generated by this macro:

- `<name>-config_elab`: produces `<name>-elab.yaml`, the elaborated data set.
- `<name>-sv`: produces `<name>_pkg.sv`, the generated SystemVerilog package
  file.
- `<name>-model-h-gen`: produces `<name>.model.h`, the performance model C++
  header.
- `<name>-model-cc-gen`: produces `<name>.model.cc`, the performance model C++
  implementation.
- `<name>-model`: the library compiling the previous two targets.
- `<name>-sysc-gen`: produces `<name>.sysc.h`, the SystemC model header
  (deprecated).
- `<name>-sysc`: the library compiling the previous target (deprecated).

TODO(jonathan): This scheme isn't perfect. The first problem is that we need a
separate codegen_design rule for each yaml file. The second problem is that
this macro assumes all files are in the same directory, and it's not clear
that the #includes will be generated correctly for dependencies in other
directories. Fixing this will require a little bazel wizardry, so I'm
postponing that for a future PR.

### Args:

- name: the name of the macro. Must be the same as the `name` attribute in the
  config file.
- config: the YAML or JSON data file. Must conform to the "design" schema
  defined in //tools/codegen/schema:design_schema.yaml.
- deps: the name of other codegen_design dependencies. Each dependency must be
  declared with its own codegen_design rule.

### `codegen_test` Macro

Usage: `codegen_test(name, expected)`

Missing documentation.

### `en_dpi_library` Macro

Usage: `en_dpi_library(name)`

Missing documentation.

______________________________________________________________________

_Documentation generated with bzldoc._
